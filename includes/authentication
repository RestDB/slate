<h1 id='authentication'>Authentication</h1>
<p>API calls against your database REST API must be authenticated. </p>

<blockquote>
<p>Example code for an authenticated API call:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="c"># With shell, you can just pass the correct header with each request</span>
curl -k -i -H <span class="s2">"Content-Type: application/json"</span><span class="se">\</span>
 -H <span class="s2">"x-apikey: MY-API-KEY-HERE"</span><span class="se">\</span>
 -X GET <span class="s1">'https://{mydatabase}.restdb.io/rest/people'</span>
</code></pre>
<blockquote>
<p>Make sure to replace <code>MY-API-KEY-HERE</code> with your actual API key.</p>
</blockquote>

<p>Authentication can be done with one of the following methods:</p>

<ul>
<li><strong>API key</strong> as a query parameter, e.g. <code>?apikey=xxxxx</code></li>
<li><strong>API key</strong> as a HTTP header field, e.g. <code>x-apikey=xxxxx</code></li>
<li><strong>Signed JWT token</strong> as a HTTP header field, <code>Authorization=Bearer xxxxx</code></li>
</ul>

<p>You can create your API keys on the admin dashboard of your database, shown in the example screenshot below.</p>

<p><img src="https://ras-blogdb.restdb.io/media/5bfe8b971c8eea7400002e95" alt="admin dashboard" /></p>
<h2 id='cors-api-keys'>CORS API keys</h2>
<blockquote>
<p>Ajax call via CORS:</p>
</blockquote>
<pre class="highlight javascript tab-javascript--browser"><code><span class="c1">// Call API from a web browser requires a CORS enabled API key</span>
<span class="kd">var</span> <span class="nx">myCorsApiKey</span> <span class="o">=</span> <span class="s2">"{MY-CORS-API-KEY-HERE}"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"readystatechange"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"https://{mydatabase}.restdb.io/rest/people"</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">"content-type"</span><span class="p">,</span> <span class="s2">"application/json"</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">"x-apikey"</span><span class="p">,</span> <span class="nx">myCorsApiKey</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">"cache-control"</span><span class="p">,</span> <span class="s2">"no-cache"</span><span class="p">);</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre>
<p>To connect to your database from a web page, a valid Ajax call with CORS must be done. CORS (cross-origin resource sharing) manages cross-origin requests. A CORS enabled API-key controls who can access the database and valid HTTP verbs agaists a data resource, i.e. <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code> and <code>DELETE</code>.</p>

<p>You can manage your API-keys unders the Settings/API tab.</p>

<p><img src="https://ras-blogdb.restdb.io/media/5603c3353c55510300000004?s=w" alt="CORS settings" /></p>
<h2 id='auth0-com-jwt-tokens'>Auth0.com JWT tokens</h2><pre class="highlight javascript tab-javascript--browser"><code><span class="kd">var</span> <span class="nx">AUTH0_CLIENT_ID</span><span class="o">=</span><span class="s1">'xxx'</span><span class="p">;</span> 
<span class="kd">var</span> <span class="nx">AUTH0_DOMAIN</span><span class="o">=</span><span class="s1">'xxx'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">AUTH0_CALLBACK_URL</span><span class="o">=</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>

<span class="c1">// invoke the lock component</span>
<span class="kd">var</span> <span class="nx">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Auth0Lock</span><span class="p">(</span><span class="nx">AUTH0_CLIENT_ID</span><span class="p">,</span> <span class="nx">AUTH0_DOMAIN</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">auth</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">params</span><span class="p">:</span> <span class="p">{</span> <span class="na">scope</span><span class="p">:</span> <span class="s1">'openid email'</span> <span class="p">}</span> <span class="c1">//Details: https://auth0.com/docs/scopes</span>
    <span class="p">},</span>
    <span class="na">rememberLastLogin</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">});</span>

  <span class="nx">$</span><span class="p">(</span><span class="s1">'.btn-login'</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="nx">lock</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">lock</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"authenticated"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">authResult</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">lock</span><span class="p">.</span><span class="nx">getProfile</span><span class="p">(</span><span class="nx">authResult</span><span class="p">.</span><span class="nx">idToken</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">profile</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">"Unable to authenticate!"</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'id_token'</span><span class="p">,</span> <span class="nx">authResult</span><span class="p">.</span><span class="nx">idToken</span><span class="p">);</span>
        <span class="c1">// Display user information</span>
        <span class="nx">show_profile_info</span><span class="p">(</span><span class="nx">profile</span><span class="p">);</span>
        <span class="c1">// enable api button</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'.btn-api'</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">"disabled"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Press me, I'm authenticated!"</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>

<span class="c1">// We use the token from Auth0 to authenticate API calls against restdb.io databases</span>
<span class="c1">// by setting the Authorization header using the Bearer token scheme.</span>

  <span class="nx">$</span><span class="p">(</span><span class="s1">'.btn-api'</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fetch</span><span class="p">(</span><span class="s2">"https://{mydatabase}.restdb.io/rest/items?max=4"</span><span class="p">,{</span>
    <span class="na">headers</span><span class="p">:{</span>
        <span class="s1">'Authorization'</span><span class="p">:</span><span class="s1">'Bearer '</span> <span class="o">+</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">"id_token"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">body</span><span class="o">=&gt;</span><span class="p">{</span>
         <span class="nx">$</span><span class="p">(</span><span class="s1">'#apidata'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'  '</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="p">});</span>
</code></pre>
<p>RestDB supports direct integration with the auth0.com authentication service. JWT (<a href="https://jwt.io/">JSON Web Token</a>) are signed with your Auth0 secret and verified by RestDB using the same secret.
Auth0.com lets you add a multitude of authentication schemes to your app.
<img src="https://ras-blogdb.restdb.io/media/57d1327a791a484c000001d2?s=o&amp;key=327688688052565719837" alt="Auth0.com lock component" /></p>

<p>You can manage the Auth0.com integration and settions under Settings/Authentication.</p>

<p><img src="https://ras-blogdb.restdb.io/media/5c04e23f587d725400000745?s=w" alt="Auth0.com secret" /></p>

<p><a target="restdb" href="https://restdb.io/blog/57cece1a2d5dbc27000000d3">Blog post with a complete demo application here.</a></p>
<h2 id='custom-jwt-api'>Custom JWT API</h2>
<p>Issue a new signed JWT with custom claims.</p>
<pre class="highlight shell tab-shell"><code>curl -X POST <span class="se">\</span>
  https://<span class="o">{</span>mydatabase<span class="o">}</span>.restdb.io/auth/jwt <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'cache-control: no-cache'</span> <span class="se">\</span>
  -H <span class="s1">'x-apikey: 021ead58943f10990f5b9b50b5e884f11bf00'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "secret": "google.private_key",
    "algorithm": "RS256",
    "issuer": "server@xxx-yyy.iam.gserviceaccount.com",
    "audience":"https://www.googleapis.com/oauth2/v4/token",
    "subject": "name@example.com",
    "expiresIn": "1h",
    "payload":{
        "scope":"https://www.googleapis.com/auth/gmail.readonly"

    }
}'</span>
</code></pre>
<blockquote>
<p>Example output</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"jwt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzY29wZSI6Imh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2F1dGgvZ21haWwucmVhZG9ubHkiLCJpYXQiOjE1NDU4MTg0MDYsImV4cCI6MTU0NTgyMjAwNiwiYXVkIjoiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3Y0L3Rva2VuIiwiaXNzIjoic2VydmVyQHh4eC15eXkuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJzdWIiOiJuYW1lQGV4YW1wbGUuY29tIiwianRpIjoiY21WemRHUmliV0ZwYkMwek5HRTRMbkpsYzNSa1lpNXFkM1F1YlhselpXTnlaWFF2TnprMU1tRXlZbVUyWVRJM09XWTNZbVJqWkRreE56ZzRaVGhoWmpsbE1UQT0ifQ.s3prKE3UO16oRhVVO9uZ-Tn8K1mF6Z6vpKGQrNwxxxM"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"refresh"</span><span class="p">:</span><span class="w"> </span><span class="s2">"853948951eca9da241e642d5c9b0383abba55571a8995e67f64e8b55eea36f53"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>HTTP REQUEST</strong></p>

<p><code>POST https://{mydatabase}.restdb.io/auth/jwt</code></p>

<p>The <code>POST</code> body Request body contains JWT settings and claims.</p>

<p><strong>ARGUMENTS</strong></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>secret</code></td>
<td><code>string</code></td>
<td>Mandatory</td>
<td>Path to settings property</td>
</tr>
<tr>
<td><code>algorithm</code></td>
<td><code>string</code></td>
<td>Optional</td>
<td>Hash algo</td>
</tr>
</tbody></table>

<aside class="warning">
*HTTPS is required. The restdb.io database REST API only responds to encrypted traffic so that your data remains safe. All API traffic must have a valid apikey or a JWT token.
</aside>
